<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <style>
      ol {
        overflow-y: auto;
        min-height: 200px;
        max-height: 250px;
        width: 50%;
        background-color: black;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>{title}</h1>
    <h2>Current serving from "{cwd}"</h2>
    <p>Hi from Rust</p>
    <div id="app">
      <ol id="messages"></ol>
    </div>
    <script>
      const messages = document.getElementById("messages");
      const app = document.getElementById("app");

      tryConnect();

      function print(...args) {
        console.log(...args);
        const pre = document.createElement("pre");
        pre.textContent = args.join("");
        messages.appendChild(pre);
        messages.scrollTop = messages.scrollHeight;
      }

      function tryConnect() {
        print("tryConnect");
        const ws = new WebSocket("ws://localhost:3012");
        ws.onmessage = (m) => {
          print(`server responded: "${m.data.replace(/\"/g, '\\"')}"`);
        };
        ws.onopen = () => {
          print("ws connection open");
          ws.send("hi from client!");
          print("message sent!");
        };
        ws.onclose = () => {
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        };

        const label = document.createElement("label");
        label.for = "edit";
        label.innerText = "search for stuff";
        const edit = document.createElement("input");
        edit.id = "edit";
        edit.type = "text";
        edit.oninput = (e) => ws.send(e.target.value);

        app.insertBefore(edit, messages);
        app.insertBefore(label, edit);
      }
    </script>
  </body>
</html>
